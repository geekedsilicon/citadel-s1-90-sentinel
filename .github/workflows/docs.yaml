# ==============================================================================
# VAELIX | SENTINEL MARK I — DOCUMENTATION PIPELINE
# ==============================================================================
# FILE:      .github/workflows/docs.yaml
# VERSION:   1.1.0 — Citadel Standard
# TARGET:    Tiny Tapeout 06 (IHP 130nm SG13G2) — ttihp26a Shuttle
# REPO:      citadel-s1-90-sentinel
#
# PURPOSE:
#   Builds the S1-90 Sentinel datasheet from docs/info.md and info.yaml,
#   then deploys it to GitHub Pages on every push to any branch.
#
# TRIGGER:
#   Fires on ALL pushes (no branch filter) and manual dispatch.
#   Branch filtering is intentionally absent — datasheet previews must
#   be available during development, not only after merge to main.
#
# FIX LOG:
#   v1.1.0 — [CRITICAL] Removed 'branches: main' filter from push trigger
#             Docs must build on all branches, not just main.
#   v1.1.0 — Added concurrency guard (cancels stale doc builds on rapid push)
#   v1.1.0 — Added permissions block (pages: write, id-token: write)
#   v1.1.0 — Step names normalized to match cross-repo Citadel standard
#   v1.0.0 — Tag updated to ttihp26a (IHP26a shuttle target)
# ==============================================================================

name: docs

on:
  push:
  workflow_dispatch:

# Cancel any in-progress doc build when a newer push arrives.
concurrency:
  group: "pages"
  cancel-in-progress: true

jobs:
  docs:
    runs-on: ubuntu-24.04

    permissions:
      pages:     write   # Required to deploy to GitHub Pages
      id-token:  write   # Required to verify deployment origin

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Build docs
        uses: TinyTapeout/tt-gds-action/docs@ttihp26a
